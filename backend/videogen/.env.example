# ==============================================================================
# Echoelmusic Video Generation API - Production Configuration
# ==============================================================================
# Copy this file to .env and configure for your environment
# NEVER commit .env with real secrets to version control
# ==============================================================================

# ------------------------------------------------------------------------------
# API Server Configuration
# ------------------------------------------------------------------------------

# Server host and port
API_HOST=0.0.0.0
API_PORT=8000

# Number of worker processes (1 for GPU-bound workloads)
API_WORKERS=1

# Request timeout in seconds
API_TIMEOUT=300

# Enable debug mode (disable in production!)
DEBUG=false

# API version
API_VERSION=1.0.0

# ------------------------------------------------------------------------------
# Security
# ------------------------------------------------------------------------------

# CORS allowed origins (comma-separated, use specific domains in production)
# Example: https://app.echoelmusic.com,https://admin.echoelmusic.com
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# Webhook signing secret (generate with: openssl rand -hex 32)
WEBHOOK_SECRET_KEY=your-webhook-secret-change-in-production

# API authentication (if enabled)
API_AUTH_ENABLED=false
API_SECRET_KEY=your-api-secret-key-change-in-production

# Flower dashboard authentication (REQUIRED for production)
# Generate password: openssl rand -base64 32
FLOWER_USER=admin
FLOWER_PASSWORD=GENERATE_SECURE_PASSWORD_HERE

# ------------------------------------------------------------------------------
# Rate Limiting
# ------------------------------------------------------------------------------

# Global rate limit (requests per second)
RATE_LIMIT_RPS=10

# Burst size (max requests before limiting)
RATE_LIMIT_BURST=50

# Redis URL for distributed rate limiting (optional)
# RATE_LIMIT_REDIS_URL=redis://localhost:6379/1

# ------------------------------------------------------------------------------
# Video Generation
# ------------------------------------------------------------------------------

# Output directory for generated videos
VIDEO_OUTPUT_DIR=/tmp/videogen/output

# Maximum video duration in seconds
MAX_VIDEO_DURATION=60

# Default video resolution (480p, 720p, 1080p, 1440p, 4k, 8k)
DEFAULT_RESOLUTION=720p

# Default FPS
DEFAULT_FPS=24

# ------------------------------------------------------------------------------
# Model Configuration
# ------------------------------------------------------------------------------

# Model to use (wan2.2-t2v-14b or wan2.2-t2v-1.3b)
MODEL_NAME=wan2.2-t2v-14b

# Model cache directory
MODEL_CACHE_DIR=/var/cache/echoelmusic/models

# Precision mode (fp32, fp16, bf16, nf4, int8)
PRECISION_MODE=bf16

# Enable TeaCache optimization (2-3x speedup)
ENABLE_TEA_CACHE=true

# TeaCache threshold (0.0-0.3, lower = more aggressive caching)
TEA_CACHE_THRESHOLD=0.1

# Enable Flash Attention 3 (requires Hopper GPU)
ENABLE_FLASH_ATTENTION=true

# Enable tiled VAE decoding (for 4K+ output)
ENABLE_TILED_VAE=true

# VAE tile size (256, 512, 1024)
VAE_TILE_SIZE=512

# ------------------------------------------------------------------------------
# GPU Configuration
# ------------------------------------------------------------------------------

# CUDA device (cuda:0, cuda:1, etc. or comma-separated for multi-GPU)
CUDA_VISIBLE_DEVICES=0

# Enable CPU offloading for low VRAM
ENABLE_CPU_OFFLOAD=false

# Enable sequential CPU offloading (more aggressive)
ENABLE_SEQUENTIAL_OFFLOAD=false

# Minimum VRAM required (GB)
MIN_VRAM_GB=8

# ------------------------------------------------------------------------------
# Task Queue (Celery/Redis)
# ------------------------------------------------------------------------------

# Redis broker URL
CELERY_BROKER_URL=redis://localhost:6379/0

# Redis result backend
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Task time limit in seconds
CELERY_TASK_TIME_LIMIT=600

# Soft time limit (warning threshold)
CELERY_TASK_SOFT_TIME_LIMIT=540

# Maximum concurrent tasks per worker
CELERY_WORKER_CONCURRENCY=1

# ------------------------------------------------------------------------------
# Observability (Prometheus/Logging)
# ------------------------------------------------------------------------------

# Log format (json or text)
LOG_FORMAT=json

# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Prometheus metrics enabled
METRICS_ENABLED=true

# Prometheus multiprocess mode directory
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus_multiproc

# Health check interval in seconds
HEALTH_CHECK_INTERVAL=30

# ------------------------------------------------------------------------------
# Webhooks
# ------------------------------------------------------------------------------

# Enable webhook notifications
WEBHOOKS_ENABLED=true

# Webhook timeout in seconds
WEBHOOK_TIMEOUT=30

# Maximum webhook retries
WEBHOOK_MAX_RETRIES=3

# Dead letter queue path
WEBHOOK_DLQ_PATH=/tmp/videogen/webhook_dlq

# ------------------------------------------------------------------------------
# LLM Integration (for prompt expansion)
# ------------------------------------------------------------------------------

# LLM provider (openai, anthropic, local)
LLM_PROVIDER=openai

# OpenAI API key (if using OpenAI)
OPENAI_API_KEY=your-openai-key-here

# Anthropic API key (if using Anthropic)
ANTHROPIC_API_KEY=your-anthropic-key-here

# Local LLM URL (if using local)
LOCAL_LLM_URL=http://localhost:11434

# Model for prompt expansion
PROMPT_EXPANSION_MODEL=gpt-4

# Enable prompt expansion
ENABLE_PROMPT_EXPANSION=true

# ------------------------------------------------------------------------------
# Image-to-Video (I2V)
# ------------------------------------------------------------------------------

# Enable I2V generation
ENABLE_I2V=true

# Default motion bucket ID (0-255, controls motion amount)
DEFAULT_MOTION_BUCKET=127

# Default image strength (0.0-1.0)
DEFAULT_IMAGE_STRENGTH=1.0

# ------------------------------------------------------------------------------
# LoRA/ControlNet
# ------------------------------------------------------------------------------

# LoRA weights directory
LORA_DIR=/var/lib/echoelmusic/loras

# ControlNet models directory
CONTROLNET_DIR=/var/lib/echoelmusic/controlnets

# IP-Adapter model path
IP_ADAPTER_PATH=/var/lib/echoelmusic/ip_adapter

# Enable LoRA support
ENABLE_LORA=true

# Enable ControlNet support
ENABLE_CONTROLNET=true

# Enable IP-Adapter
ENABLE_IP_ADAPTER=true

# ------------------------------------------------------------------------------
# Storage (S3-compatible)
# ------------------------------------------------------------------------------

# Enable S3 storage for outputs
S3_ENABLED=false

# S3 endpoint URL
S3_ENDPOINT_URL=https://s3.amazonaws.com

# S3 bucket name
S3_BUCKET_NAME=echoelmusic-videos

# S3 access key
S3_ACCESS_KEY=your-s3-access-key

# S3 secret key
S3_SECRET_KEY=your-s3-secret-key

# S3 region
S3_REGION=us-east-1

# ------------------------------------------------------------------------------
# Monitoring & Alerting
# ------------------------------------------------------------------------------

# Sentry DSN for error tracking
SENTRY_DSN=

# PagerDuty integration key
PAGERDUTY_KEY=

# Slack webhook for alerts
SLACK_WEBHOOK_URL=

# ------------------------------------------------------------------------------
# Feature Flags
# ------------------------------------------------------------------------------

# Enable 8K upscaling
ENABLE_8K_UPSCALE=false

# Enable experimental features
ENABLE_EXPERIMENTAL=false

# Enable batch processing
ENABLE_BATCH_PROCESSING=true

# Maximum batch size
MAX_BATCH_SIZE=10
