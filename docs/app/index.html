<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Echoelmusic Web App - Bio-Reactive Synthesizer</title>
    <meta name="description" content="Interactive bio-reactive synthesizer demo. Experience Echoelmusic in your browser.">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#22C55E">
    <style>
        :root {
            --primary: #22C55E;
            --secondary: #10B981;
            --bg: #030712;
            --surface: #0a1a0f;
            --text: #ffffff;
            --muted: rgba(255,255,255,0.6);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid rgba(34,197,94,0.2);
        }
        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: var(--muted); margin-top: 8px; }
        .version { font-size: 0.75rem; color: var(--primary); margin-top: 4px; }

        /* Bio Display */
        .bio-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }
        .bio-card {
            background: var(--surface);
            border: 1px solid rgba(34,197,94,0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .bio-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        .bio-label { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }

        /* Synth Controls */
        .synth-section {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }
        .section-title {
            font-size: 0.875rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }
        .control {
            text-align: center;
        }
        .control label {
            display: block;
            font-size: 0.7rem;
            color: var(--muted);
            margin-bottom: 8px;
        }
        .control input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            background: rgba(34,197,94,0.2);
            height: 8px;
            border-radius: 4px;
            outline: none;
        }
        .control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }
        .control-value {
            font-size: 0.875rem;
            color: var(--text);
            margin-top: 4px;
        }

        /* Keyboard */
        .keyboard {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 24px 0;
            flex-wrap: wrap;
        }
        .key {
            width: 48px;
            height: 140px;
            background: linear-gradient(180deg, #fff, #e0e0e0);
            border: 1px solid #999;
            border-radius: 0 0 6px 6px;
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
        }
        .key:active, .key.active {
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            transform: translateY(2px);
        }
        .key.black {
            width: 32px;
            height: 90px;
            background: linear-gradient(180deg, #333, #111);
            margin: 0 -16px;
            z-index: 1;
            border-color: #000;
        }
        .key.black:active, .key.black.active {
            background: linear-gradient(180deg, #1a472a, #0d3320);
        }

        /* Visualizer */
        .visualizer {
            height: 120px;
            background: var(--surface);
            border-radius: 12px;
            margin: 24px 0;
            overflow: hidden;
        }
        #waveform {
            width: 100%;
            height: 100%;
        }

        /* Buttons */
        .btn-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 24px 0;
        }
        .btn {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--primary);
            color: var(--bg);
        }
        .btn-primary:hover { background: var(--secondary); }
        .btn-secondary {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        /* Presets */
        .presets {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .preset {
            padding: 8px 16px;
            background: rgba(34,197,94,0.1);
            border: 1px solid rgba(34,197,94,0.3);
            border-radius: 20px;
            color: var(--text);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .preset:hover, .preset.active {
            background: var(--primary);
            color: var(--bg);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--muted);
            font-size: 0.875rem;
        }
        footer a { color: var(--primary); text-decoration: none; }

        @media (max-width: 600px) {
            .controls-grid { grid-template-columns: repeat(2, 1fr); }
            .bio-display { grid-template-columns: 1fr; }
            .key { width: 36px; height: 100px; }
            .key.black { width: 24px; height: 65px; margin: 0 -12px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Echoelmusic</h1>
        <p class="subtitle">Bio-Reactive Synthesizer</p>
        <p class="version">v10.0.0 - Phase 10000 ULTIMATE</p>
    </header>

    <div class="container">
        <!-- Simulated Bio Display -->
        <div class="bio-display">
            <div class="bio-card">
                <div class="bio-value" id="heartRate">72</div>
                <div class="bio-label">Heart Rate (BPM)</div>
            </div>
            <div class="bio-card">
                <div class="bio-value" id="hrv">45</div>
                <div class="bio-label">HRV (ms)</div>
            </div>
            <div class="bio-card">
                <div class="bio-value" id="coherence">0.65</div>
                <div class="bio-label">Coherence</div>
            </div>
        </div>

        <!-- Waveform Visualizer -->
        <div class="visualizer">
            <canvas id="waveform"></canvas>
        </div>

        <!-- Synth Controls -->
        <div class="synth-section">
            <div class="section-title">Oscillator</div>
            <div class="controls-grid">
                <div class="control">
                    <label>ATTACK</label>
                    <input type="range" id="attack" min="0" max="2" step="0.01" value="0.1">
                    <div class="control-value" id="attackVal">0.1s</div>
                </div>
                <div class="control">
                    <label>DECAY</label>
                    <input type="range" id="decay" min="0" max="2" step="0.01" value="0.3">
                    <div class="control-value" id="decayVal">0.3s</div>
                </div>
                <div class="control">
                    <label>SUSTAIN</label>
                    <input type="range" id="sustain" min="0" max="1" step="0.01" value="0.7">
                    <div class="control-value" id="sustainVal">70%</div>
                </div>
                <div class="control">
                    <label>RELEASE</label>
                    <input type="range" id="release" min="0" max="3" step="0.01" value="0.5">
                    <div class="control-value" id="releaseVal">0.5s</div>
                </div>
            </div>
        </div>

        <div class="synth-section">
            <div class="section-title">Filter (Bio-Linked)</div>
            <div class="controls-grid">
                <div class="control">
                    <label>CUTOFF</label>
                    <input type="range" id="cutoff" min="100" max="8000" step="10" value="2000">
                    <div class="control-value" id="cutoffVal">2000 Hz</div>
                </div>
                <div class="control">
                    <label>RESONANCE</label>
                    <input type="range" id="resonance" min="0" max="20" step="0.1" value="5">
                    <div class="control-value" id="resonanceVal">5.0</div>
                </div>
                <div class="control">
                    <label>REVERB</label>
                    <input type="range" id="reverb" min="0" max="1" step="0.01" value="0.3">
                    <div class="control-value" id="reverbVal">30%</div>
                </div>
                <div class="control">
                    <label>VOLUME</label>
                    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
                    <div class="control-value" id="volumeVal">50%</div>
                </div>
            </div>
        </div>

        <!-- Presets -->
        <div class="synth-section">
            <div class="section-title">Presets</div>
            <div class="presets">
                <div class="preset active" data-preset="coherent">Coherent Pad</div>
                <div class="preset" data-preset="pulse">Heart Pulse</div>
                <div class="preset" data-preset="breath">Breath Wave</div>
                <div class="preset" data-preset="quantum">Quantum</div>
                <div class="preset" data-preset="meditation">Meditation</div>
            </div>
        </div>

        <!-- Keyboard -->
        <div class="synth-section">
            <div class="section-title">Play (or use keyboard A-L)</div>
            <div class="keyboard" id="keyboard">
                <div class="key" data-note="C4"></div>
                <div class="key black" data-note="C#4"></div>
                <div class="key" data-note="D4"></div>
                <div class="key black" data-note="D#4"></div>
                <div class="key" data-note="E4"></div>
                <div class="key" data-note="F4"></div>
                <div class="key black" data-note="F#4"></div>
                <div class="key" data-note="G4"></div>
                <div class="key black" data-note="G#4"></div>
                <div class="key" data-note="A4"></div>
                <div class="key black" data-note="A#4"></div>
                <div class="key" data-note="B4"></div>
                <div class="key" data-note="C5"></div>
            </div>
        </div>

        <div class="btn-row">
            <button class="btn btn-primary" id="startAudio">Start Audio</button>
            <button class="btn btn-secondary" id="bioSync">Bio Sync</button>
        </div>
    </div>

    <footer>
        <p>Echoelmusic Web Demo - <a href="../">Back to Home</a></p>
        <p style="margin-top:8px;font-size:0.75rem;">For full experience, download the native app for iOS, Android, macOS, Windows, or Linux.</p>
    </footer>

    <script>
        // Web Audio API Synthesizer
        let audioCtx = null;
        let masterGain = null;
        let filter = null;
        let convolver = null;
        let analyser = null;
        const activeOscillators = {};

        // Note frequencies
        const noteFreq = {
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
            'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
            'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
            'C5': 523.25
        };

        // Keyboard mapping
        const keyMap = {
            'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
            'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
            'u': 'A#4', 'j': 'B4', 'k': 'C5'
        };

        // ADSR parameters
        let adsr = { attack: 0.1, decay: 0.3, sustain: 0.7, release: 0.5 };

        // Initialize audio
        function initAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            // Master gain
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.5;

            // Filter
            filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 2000;
            filter.Q.value = 5;

            // Analyser for visualization
            analyser = audioCtx.createAnalyser();
            analyser.fftSize = 2048;

            // Simple reverb using delay
            const delay = audioCtx.createDelay();
            delay.delayTime.value = 0.3;
            const feedback = audioCtx.createGain();
            feedback.gain.value = 0.3;

            // Connect nodes
            filter.connect(delay);
            delay.connect(feedback);
            feedback.connect(delay);
            delay.connect(masterGain);
            filter.connect(masterGain);
            masterGain.connect(analyser);
            analyser.connect(audioCtx.destination);

            document.getElementById('startAudio').textContent = 'Audio Running';
            startVisualization();
        }

        // Play note
        function playNote(note) {
            if (!audioCtx) initAudio();
            if (activeOscillators[note]) return;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sawtooth';
            osc.frequency.value = noteFreq[note];

            // ADSR envelope
            const now = audioCtx.currentTime;
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(1, now + adsr.attack);
            gain.gain.linearRampToValueAtTime(adsr.sustain, now + adsr.attack + adsr.decay);

            osc.connect(gain);
            gain.connect(filter);
            osc.start();

            activeOscillators[note] = { osc, gain };

            // Visual feedback
            const key = document.querySelector(`[data-note="${note}"]`);
            if (key) key.classList.add('active');
        }

        // Stop note
        function stopNote(note) {
            if (!activeOscillators[note]) return;

            const { osc, gain } = activeOscillators[note];
            const now = audioCtx.currentTime;

            gain.gain.cancelScheduledValues(now);
            gain.gain.setValueAtTime(gain.gain.value, now);
            gain.gain.linearRampToValueAtTime(0, now + adsr.release);

            osc.stop(now + adsr.release + 0.1);
            delete activeOscillators[note];

            // Visual feedback
            const key = document.querySelector(`[data-note="${note}"]`);
            if (key) key.classList.remove('active');
        }

        // Visualization
        function startVisualization() {
            const canvas = document.getElementById('waveform');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            function draw() {
                requestAnimationFrame(draw);
                analyser.getByteTimeDomainData(dataArray);

                ctx.fillStyle = '#0a1a0f';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.lineWidth = 2;
                ctx.strokeStyle = '#22C55E';
                ctx.beginPath();

                const sliceWidth = canvas.width / bufferLength;
                let x = 0;

                for (let i = 0; i < bufferLength; i++) {
                    const v = dataArray[i] / 128.0;
                    const y = v * canvas.height / 2;

                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                    x += sliceWidth;
                }

                ctx.lineTo(canvas.width, canvas.height / 2);
                ctx.stroke();
            }
            draw();
        }

        // Bio simulation
        let bioInterval;
        function startBioSimulation() {
            if (bioInterval) return;
            bioInterval = setInterval(() => {
                const hr = 60 + Math.random() * 30;
                const hrv = 30 + Math.random() * 40;
                const coherence = 0.3 + Math.random() * 0.5;

                document.getElementById('heartRate').textContent = Math.round(hr);
                document.getElementById('hrv').textContent = Math.round(hrv);
                document.getElementById('coherence').textContent = coherence.toFixed(2);

                // Bio-reactive filter modulation
                if (filter) {
                    filter.frequency.value = 500 + coherence * 4000;
                    document.getElementById('cutoff').value = filter.frequency.value;
                    document.getElementById('cutoffVal').textContent = Math.round(filter.frequency.value) + ' Hz';
                }
            }, 1000);
            document.getElementById('bioSync').textContent = 'Bio Synced';
        }

        // Event listeners
        document.getElementById('startAudio').addEventListener('click', initAudio);
        document.getElementById('bioSync').addEventListener('click', startBioSimulation);

        // Keyboard events
        document.querySelectorAll('.key').forEach(key => {
            key.addEventListener('mousedown', () => playNote(key.dataset.note));
            key.addEventListener('mouseup', () => stopNote(key.dataset.note));
            key.addEventListener('mouseleave', () => stopNote(key.dataset.note));
            key.addEventListener('touchstart', (e) => { e.preventDefault(); playNote(key.dataset.note); });
            key.addEventListener('touchend', () => stopNote(key.dataset.note));
        });

        document.addEventListener('keydown', (e) => {
            if (keyMap[e.key] && !e.repeat) playNote(keyMap[e.key]);
        });
        document.addEventListener('keyup', (e) => {
            if (keyMap[e.key]) stopNote(keyMap[e.key]);
        });

        // Control sliders
        ['attack', 'decay', 'sustain', 'release'].forEach(param => {
            const slider = document.getElementById(param);
            slider.addEventListener('input', () => {
                adsr[param] = parseFloat(slider.value);
                const suffix = param === 'sustain' ? '%' : 's';
                const val = param === 'sustain' ? Math.round(adsr[param] * 100) : adsr[param].toFixed(2);
                document.getElementById(param + 'Val').textContent = val + suffix;
            });
        });

        document.getElementById('cutoff').addEventListener('input', (e) => {
            if (filter) filter.frequency.value = e.target.value;
            document.getElementById('cutoffVal').textContent = e.target.value + ' Hz';
        });

        document.getElementById('resonance').addEventListener('input', (e) => {
            if (filter) filter.Q.value = e.target.value;
            document.getElementById('resonanceVal').textContent = parseFloat(e.target.value).toFixed(1);
        });

        document.getElementById('volume').addEventListener('input', (e) => {
            if (masterGain) masterGain.gain.value = e.target.value;
            document.getElementById('volumeVal').textContent = Math.round(e.target.value * 100) + '%';
        });

        // Presets
        const presets = {
            coherent: { attack: 0.3, decay: 0.5, sustain: 0.8, release: 1.0, cutoff: 3000 },
            pulse: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.3, cutoff: 5000 },
            breath: { attack: 1.0, decay: 0.5, sustain: 0.6, release: 2.0, cutoff: 1500 },
            quantum: { attack: 0.05, decay: 0.3, sustain: 0.9, release: 0.8, cutoff: 6000 },
            meditation: { attack: 2.0, decay: 1.0, sustain: 0.7, release: 3.0, cutoff: 1000 }
        };

        document.querySelectorAll('.preset').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const p = presets[btn.dataset.preset];
                if (p) {
                    adsr = { attack: p.attack, decay: p.decay, sustain: p.sustain, release: p.release };
                    ['attack', 'decay', 'sustain', 'release'].forEach(param => {
                        document.getElementById(param).value = adsr[param];
                        const suffix = param === 'sustain' ? '%' : 's';
                        const val = param === 'sustain' ? Math.round(adsr[param] * 100) : adsr[param].toFixed(2);
                        document.getElementById(param + 'Val').textContent = val + suffix;
                    });
                    if (filter) filter.frequency.value = p.cutoff;
                    document.getElementById('cutoff').value = p.cutoff;
                    document.getElementById('cutoffVal').textContent = p.cutoff + ' Hz';
                }
            });
        });
    </script>
</body>
</html>
