<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="refresh" content="60">
  <title>Echoelmusic Status</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .status-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-left: 5px solid #ccc;
      transition: all 0.3s ease;
    }

    .status-card.operational {
      border-left-color: #28a745;
    }

    .status-card.degraded {
      border-left-color: #ffc107;
    }

    .status-card.down {
      border-left-color: #dc3545;
    }

    .status-card.checking {
      border-left-color: #667eea;
    }

    .status-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .status-icon {
      font-size: 2em;
    }

    .status-name {
      font-weight: bold;
      font-size: 1.1em;
      color: #333;
    }

    .status-message {
      color: #666;
      font-size: 0.9em;
      margin-top: 10px;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-operational {
      background: #d4edda;
      color: #155724;
    }

    .badge-degraded {
      background: #fff3cd;
      color: #856404;
    }

    .badge-down {
      background: #f8d7da;
      color: #721c24;
    }

    .badge-checking {
      background: #e7f1ff;
      color: #667eea;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .metric {
      text-align: center;
    }

    .metric-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #667eea;
    }

    .metric-label {
      font-size: 0.8em;
      color: #888;
      margin-top: 4px;
    }

    .last-updated {
      text-align: center;
      color: #888;
      font-size: 0.9em;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #eee;
    }

    .update-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9em;
      margin-left: 10px;
    }

    .update-btn:hover {
      background: #764ba2;
    }

    .loading {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      vertical-align: middle;
      margin-left: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .overall-status {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      margin-bottom: 30px;
    }

    .overall-status h2 {
      color: white;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .overall-status p {
      font-size: 1.2em;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéµ Echoelmusic</h1>
      <p class="subtitle"><a href="index.html">‚Üê Back to Legal Docs</a></p>
    </header>

    <main>
      <div class="overall-status" id="overallStatus">
        <h2>All Systems Operational</h2>
        <p>Last checked: <span id="lastCheck">Never</span></p>
      </div>

      <div class="status-grid" id="statusGrid">
        <!-- Status cards will be populated here -->
      </div>

      <div class="last-updated">
        <span>Auto-refresh every 60 seconds</span>
        <button class="update-btn" onclick="checkAllStatuses()">
          <span id="btnText">Refresh Now</span>
        </button>
      </div>
    </main>

    <footer>
      <p style="text-align: center; color: #888; margin-top: 40px;">
        For support: <a href="mailto:support@echoelmusic.com">support@echoelmusic.com</a>
      </p>
      <p style="text-align: center; color: #888;">
        ¬© 2024 Echoel (Michael Terbuyken)
      </p>
    </footer>
  </div>

  <script>
    const services = [
      {
        id: 'api',
        name: 'API Server',
        endpoint: 'https://api.echoelmusic.com/health',
        icon: 'üñ•Ô∏è',
        description: 'Main backend API'
      },
      {
        id: 'database',
        name: 'Database',
        endpoint: 'https://api.echoelmusic.com/api/health/db',
        icon: 'üóÑÔ∏è',
        description: 'Supabase PostgreSQL'
      },
      {
        id: 'legal',
        name: 'Legal Pages',
        endpoint: 'https://vibrationalforce.github.io/echoelmusic-legal/',
        icon: 'üìú',
        description: 'DSGVO, AGB, Impressum'
      }
    ];

    let statuses = {};

    async function checkStatus(service) {
      const startTime = Date.now();

      try {
        const response = await fetch(service.endpoint, {
          method: 'GET',
          mode: 'cors',
          cache: 'no-cache'
        });

        const responseTime = Date.now() - startTime;

        if (response.ok) {
          return {
            status: 'operational',
            message: 'All systems nominal',
            responseTime: responseTime,
            lastCheck: new Date().toLocaleTimeString()
          };
        } else {
          return {
            status: 'degraded',
            message: `HTTP ${response.status}`,
            responseTime: responseTime,
            lastCheck: new Date().toLocaleTimeString()
          };
        }
      } catch (error) {
        return {
          status: 'down',
          message: error.message || 'Connection failed',
          responseTime: null,
          lastCheck: new Date().toLocaleTimeString()
        };
      }
    }

    function renderStatus(service, status) {
      const statusClass = status.status;
      const badgeClass = `badge-${statusClass}`;

      let statusText = {
        operational: 'Operational',
        degraded: 'Degraded',
        down: 'Down',
        checking: 'Checking...'
      }[statusClass] || 'Unknown';

      let metrics = '';
      if (status.responseTime !== null) {
        const uptimePercent = statusClass === 'operational' ? '99.9' : '0.0';
        metrics = `
          <div class="metrics">
            <div class="metric">
              <div class="metric-value">${status.responseTime}ms</div>
              <div class="metric-label">Response</div>
            </div>
            <div class="metric">
              <div class="metric-value">${uptimePercent}%</div>
              <div class="metric-label">Uptime</div>
            </div>
            <div class="metric">
              <div class="metric-value">${status.lastCheck}</div>
              <div class="metric-label">Last Check</div>
            </div>
          </div>
        `;
      }

      return `
        <div class="status-card ${statusClass}">
          <div class="status-header">
            <div>
              <div class="status-icon">${service.icon}</div>
              <div class="status-name">${service.name}</div>
            </div>
            <span class="status-badge ${badgeClass}">${statusText}</span>
          </div>
          <div class="status-message">${service.description}</div>
          <div class="status-message" style="font-style: italic; color: #999;">
            ${status.message}
          </div>
          ${metrics}
        </div>
      `;
    }

    function updateOverallStatus() {
      const statuses = Object.values(window.statuses);
      const allOperational = statuses.every(s => s.status === 'operational');
      const anyDown = statuses.some(s => s.status === 'down');

      const overall = document.getElementById('overallStatus');

      if (allOperational) {
        overall.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
        overall.querySelector('h2').textContent = '‚úÖ All Systems Operational';
        overall.querySelector('p').textContent = 'Everything is running smoothly!';
      } else if (anyDown) {
        overall.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
        overall.querySelector('h2').textContent = '‚ùå Service Disruption';
        overall.querySelector('p').textContent = 'Some services are experiencing issues';
      } else {
        overall.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
        overall.querySelector('h2').textContent = '‚ö†Ô∏è Degraded Performance';
        overall.querySelector('p').textContent = 'Some services are running slowly';
      }

      document.getElementById('lastCheck').textContent = new Date().toLocaleTimeString();
    }

    async function checkAllStatuses() {
      const btn = document.getElementById('btnText');
      btn.innerHTML = 'Checking<span class="loading"></span>';

      // Set all to checking state
      const grid = document.getElementById('statusGrid');
      grid.innerHTML = services.map(service => renderStatus(service, {
        status: 'checking',
        message: 'Checking status...',
        responseTime: null,
        lastCheck: 'Checking...'
      })).join('');

      // Check all services in parallel
      const checks = services.map(async (service) => {
        const status = await checkStatus(service);
        window.statuses[service.id] = status;
        return { service, status };
      });

      const results = await Promise.all(checks);

      // Render all results
      grid.innerHTML = results.map(({ service, status }) =>
        renderStatus(service, status)
      ).join('');

      updateOverallStatus();

      btn.textContent = 'Refresh Now';
    }

    // Initialize
    window.statuses = {};

    // Check on load
    window.addEventListener('load', checkAllStatuses);

    // Auto-refresh every 60 seconds (page already has meta refresh, but this updates without reload)
    setInterval(checkAllStatuses, 60000);
  </script>
</body>
</html>
