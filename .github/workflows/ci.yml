#
# CI/CD Pipeline for EOEL
# Automated testing, building, and deployment
#

name: EOEL CI/CD Pipeline

on:
  push:
    branches: [ main, develop, 'claude/**' ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  XCODE_VERSION: '15.2'
  IOS_DEPLOYMENT_TARGET: '17.0'

jobs:
  code-quality:
    name: Code Quality
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4
      - name: Run SwiftLint
        run: |
          if command -v swiftlint &> /dev/null; then
            swiftlint lint --reporter github-actions-logging
          else
            echo "SwiftLint not installed"
          fi
        continue-on-error: true

  unit-tests:
    name: Unit Tests
    runs-on: macos-14
    needs: code-quality
    steps:
      - uses: actions/checkout@v4
      - name: Run tests
        run: |
          xcodebuild test \
            -scheme EOEL \
            -destination "platform=iOS Simulator,name=iPhone 15 Pro" \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO
        continue-on-error: true

  build:
    name: Build
    runs-on: macos-14
    needs: unit-tests
    steps:
      - uses: actions/checkout@v4
      - name: Build
        run: |
          xcodebuild build \
            -scheme EOEL \
            -destination "platform=iOS Simulator,name=iPhone 15 Pro" \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO
